var angular = require('angular');
var expect = require('chai').expect;

describe.only('loginForm directive', function() {
  beforeEach(function() {
    var ctx = this;

    angular.mock.module('ngMock', 'epsonreceipts');
    angular.mock.module({
      sessionStorage: return {
        login: function() {
          ctx.sinon.stub()
          return {
            success: function(args) {},
            error: function(args) {}
          }
        }
      }
    });
    angular.mock.inject(function($rootScope, $compile, $state) {
      ctx.scope = $rootScope.$new();

      ctx.compile = function() {
        ctx.element = $compile('<login-form></login-form>')(ctx.scope);
        ctx.scope.$digest();
      };
    });
    ctx.compile();
  });

  it('should submit te users email and password to sessionStorage', function() {
    var ctx = this;
    ctx.scope.user = ({
      email: 'a@a.com',
      password: 'a'
    });
    ctx.scope.submit();
    expect(ctx.sinon.stub).to.have.been.calledWith('a@a.com', 'a');
  });
});
